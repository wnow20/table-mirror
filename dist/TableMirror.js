function TableMirror(o){this.options=_.extend({},defaults,o),this.el=this.options.el,this.init()}var _=require("lodash"),defaults={sort:!1,mergeRows:[]},win=window,global=win,doc=win.document;doc.querySelector||console.error("your browser is not support Document.querySelector() function!"),TableMirror.prototype.log=function(o){var r=this;if(o=o?o:"","undefined"==typeof r.logCount&&(r.logCount=0),r.logCount++,r.logCount>2e3)throw new Error("可能出现死循环, "+o);console.log(o)},TableMirror.prototype.init=function(){console.log("init");var o=this;"string"==typeof o.el&&(o.el=doc.querySelector(o.el)),o.mirror={thead:[],tbody:[]},o._cacheTableNodes(),o.options.sort&&o.sort(),"string"==typeof o.options.mergeRows&&(o.options.mergeRows=o.options.mergeRows.split(",")),console.log("initd")},TableMirror.prototype.sort=function(){},TableMirror.prototype._cacheTableNodes=function(){console.log("_cacheTableNodes");var o,r=this,e=r.el.childNodes,t=r.mirror;r.table=r.el;for(var n=0;n<e.length;n++)o=e.item(n),"TBODY"===o.nodeName&&(r.tbody=o),"THEAD"===o.nodeName&&(r.thead=o);for(var i=r.thead.children[0].children,n=0;n<i.length;n++)t.thead[n]={text:i.item(n).textContent,node:i.item(n)};r.logCount=0;for(var l,s=r.tbody.children,a=0;a<s.length;a++){l=s.item(a).children;for(var h=0;h<l.length;h++)r.addCell({x:h,y:a,text:_.trim(l.item(h).textContent),node:l.item(h)})}r.mirror.cols=h,r.mirror.rows=a},TableMirror.prototype.cell=function(o,r){var e=this,t=e.mirror.tbody;return e.mirror.cols<o+1||e.mirror.rows<r+1||0>o||0>r?null:t[o][r]},TableMirror.prototype.col=function(o){var r=this,e=r.mirror.tbody,t=[];return r.mirror.cols<o+1?[]:t=e[o]},TableMirror.prototype.row=function(o){var r=this,e=r.mirror.tbody,t=[];if(r.mirror.rows<o+1)return[];for(var n=0;n<e.length;n++)t.push(e[n][o]);return t},TableMirror.prototype.updateCell=function(){},TableMirror.prototype.addCell=function(o){var r=this,e=o.x,t=o.y,n=r.mirror.tbody;n[e]||(n[e]=[]),n[e][t]=o},TableMirror.prototype.mergeRows_index=function(o){for(var r=this,e=r.mirror.thead,t=0;t<e.length;t++)if(e[t].text===o)return t},TableMirror.prototype.mergeRows=function(){function o(){d=[]}var r=this,e=r.options.mergeRows;r.mergeRows_removedCell_cache=[];for(var t,n,i,l,s,a,h,c=[],d=[],u={},p=0,g=0;g<e.length;g++){o(),l=e[g],p=r.mergeRows_index(l),t=r.col(p);for(var f=0;f<t.length;f++)if(n=r.cell(p,f),i=r.cell(p,f-1),h=u[[p-1,f].join(",")],d.length&&i)if(i.text===n.text&&(h>d.length||!h)){d.push(n);for(var m=0;m<d.length;m++)a=d[m],s=[a.x,a.y].join(","),u[s]=d.length;t.length===f+1&&(c.push(d),o())}else d.length>1&&c.push(d),o(),d.push(n);else{d.push(n);for(var m=0;m<d.length;m++)a=d[m],s=[a.x,a.y].join(","),u[s]=d.length}}requestAnimationFrame(function(){for(var o,r=0;r<c.length;r++){o=c[r],o[0].node.setAttribute("rowspan",o.length);for(var e=1;e<o.length;e++)o[e].node.remove()}})},module.exports=TableMirror;